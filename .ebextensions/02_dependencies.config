packages:
  yum:
    git: []
    gcc: []
    gcc-c++: []
    python3-devel: []
    libffi-devel: []
    openssl-devel: []
commands:
  01_pip_upgrade:
    command: "pip3 install --upgrade pip"
  01_5_diagnose_python: # NOVO COMANDO DE DIAGNÓSTICO
    command: |
      #!/bin/bash
      set -e # Sai imediatamente se um comando falhar
      set -x # Imprime cada comando executado para o log
      echo "--- Início do Diagnóstico Python/pip ---"
      echo "Caminho do python3:"
      which python3
      echo "Versão do python3:"
      python3 --version
      echo "Caminho do pip3:"
      which pip3
      echo "Versão do pip3:"
      pip3 --version
      echo "Conteúdo de req.txt (primeiras 5 linhas):"
      head -n 5 req.txt # Tenta ler o arquivo req.txt
      echo "--- Fim do Diagnóstico Python/pip ---"
      # Redireciona a saída desse script para um log que o EB empacota
      # Esta saída será crucial.
      # Removendo o redirecionamento aqui para tentar capturar a saída no cfn-init.log ou eb-engine.log
  02_install_requirements:
    command: "pip3 install -r req.txt" # Simplificado novamente, sem redirecionamento para arquivo separado
    # Se este comando falhar, o set -x do diagnóstico anterior pode nos dar mais detalhes.